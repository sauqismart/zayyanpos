<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Kasir Sempurna</title>
    <!-- Menggunakan Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Menggunakan Google Fonts untuk tipografi -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet"/>
</head>

<!-- =================================================================
     == BAGIAN 2: CSS (Gaya Tampilan)
     == ----------------------------------------------------------- ==
     == Bagian ini mengatur semua gaya visual aplikasi seperti warna,
     == font, dan efek custom.
     ================================================================= -->
<style>
    /* Style kustom untuk scrollbar agar lebih modern */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; }
    ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #64748b; }
    
    /* Menggunakan font Inter sebagai default */
    body {
        font-family: 'Inter', sans-serif;
        background-color: #f8fafc; /* Warna latar belakang lebih cerah */
    }
    .active-nav {
        background-color: #0d9488;
        color: white;
    }
    .nav-item:hover {
        background-color: #14b8a6;
        color: white;
    }
    /* Animasi untuk modal */
    .modal-enter {
        opacity: 0;
        transform: scale(0.95);
    }
    .modal-enter-active {
        opacity: 1;
        transform: scale(1);
        transition: all 300ms ease-out;
    }
    .modal-leave {
        opacity: 1;
        transform: scale(1);
    }
    .modal-leave-active {
        opacity: 0;
        transform: scale(0.95);
        transition: all 300ms ease-in;
    }
</style>

<body class="antialiased text-slate-800">

<!-- =================================================================
     == BAGIAN 1: HTML (Struktur Halaman)
     == ----------------------------------------------------------- ==
     == Bagian ini berisi semua elemen yang membentuk tampilan
     == aplikasi, seperti sidebar, area utama, tabel, dan modal.
     ================================================================= -->
<div class="flex flex-col lg:flex-row min-h-screen">
    <!-- Sidebar Navigasi -->
    <nav class="bg-teal-600 text-white w-full lg:w-64 flex-shrink-0">
        <div class="flex items-center justify-center p-4 lg:p-6 shadow-md">
            <i class="ri-shopping-cart-2-fill text-3xl mr-3"></i>
            <h1 class="text-xl font-bold">KasirKu V2</h1>
        </div>
        <ul class="flex flex-row lg:flex-col p-2 lg:p-4 lg:space-y-2 justify-center lg:justify-start">
            <li><a href="#" class="flex items-center p-3 rounded-lg nav-item active-nav"><i class="ri-money-dollar-box-line text-xl mr-3"></i><span class="hidden lg:inline">Transaksi</span></a></li>
            <li><a href="#" class="flex items-center p-3 rounded-lg nav-item"><i class="ri-database-2-line text-xl mr-3"></i><span class="hidden lg:inline">Database</span></a></li>
            <li><a href="#" class="flex items-center p-3 rounded-lg nav-item"><i class="ri-time-line text-xl mr-3"></i><span class="hidden lg:inline">Shift</span></a></li>
            <li><a href="#" class="flex items-center p-3 rounded-lg nav-item"><i class="ri-file-chart-line text-xl mr-3"></i><span class="hidden lg:inline">Laporan</span></a></li>
            <li><a href="#" class="flex items-center p-3 rounded-lg nav-item"><i class="ri-bank-line text-xl mr-3"></i><span class="hidden lg:inline">Keuangan</span></a></li>
            <li><a href="#" class="flex items-center p-3 rounded-lg nav-item"><i class="ri-settings-3-line text-xl mr-3"></i><span class="hidden lg:inline">Pengaturan</span></a></li>
        </ul>
    </nav>

    <!-- Konten Utama -->
    <main class="flex-1 p-4 lg:p-6 xl:p-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 xl:gap-8 h-full">
            
            <!-- Kolom Kiri & Tengah: Transaksi -->
            <div class="lg:col-span-2 flex flex-col h-full">
                <!-- Header -->
                <div class="flex-shrink-0 flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <div>
                        <h2 class="text-3xl font-bold text-slate-800">Transaksi Penjualan</h2>
                        <p id="current-date" class="text-slate-500 mt-1">Memuat tanggal...</p>
                    </div>
                </div>
                
                <!-- Keranjang Belanja -->
                <div class="bg-white rounded-xl shadow-md flex flex-col flex-grow">
                    <!-- Tabel Header -->
                    <div class="p-4 border-b border-slate-200">
                        <h3 class="text-lg font-semibold">Keranjang</h3>
                    </div>
                    <!-- Tabel Konten -->
                    <div class="overflow-y-auto flex-grow">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 sticky top-0">
                                <tr>
                                    <th class="p-4 font-semibold text-slate-600 text-sm">PRODUK</th>
                                    <th class="p-4 font-semibold text-slate-600 text-sm text-right">HARGA</th>
                                    <th class="p-4 font-semibold text-slate-600 text-sm text-center">QTY</th>
                                    <th class="p-4 font-semibold text-slate-600 text-sm text-right">SUBTOTAL</th>
                                    <th class="p-4 font-semibold text-slate-600 text-sm text-center"></th>
                                </tr>
                            </thead>
                            <tbody id="cart-items-container">
                                <tr id="empty-cart-message">
                                    <td colspan="5" class="text-center p-16 text-slate-400">
                                        <i class="ri-shopping-cart-line text-5xl mb-4"></i>
                                        <p class="font-medium">Keranjang masih kosong</p>
                                        <p class="text-sm">Pilih produk dari daftar di sebelah kanan.</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                     <!-- Total & Pembayaran -->
                    <div class="flex-shrink-0 bg-slate-50 p-4 border-t border-slate-200 rounded-b-xl">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="space-y-2">
                                <select id="discount-type" class="w-full p-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-sm">
                                    <option value="0">Tidak Ada Diskon</option>
                                    <option value="5">Promo Gajian (5%)</option>
                                    <option value="10">Member Silver (10%)</option>
                                </select>
                                <select id="tax-type" class="w-full p-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 text-sm">
                                    <option value="0">Tidak Kena Pajak</option>
                                    <option value="11">PPN (11%)</option>
                                </select>
                            </div>
                            <div>
                                <div class="space-y-1 text-sm">
                                    <div class="flex justify-between text-slate-600"><span>SubTotal</span><span id="subtotal-amount" class="font-medium">Rp 0</span></div>
                                    <div class="flex justify-between text-slate-600"><span>Diskon (<span id="discount-percentage">0%</span>)</span><span id="discount-amount" class="font-medium text-green-600">- Rp 0</span></div>
                                    <div class="flex justify-between text-slate-600"><span>Pajak (<span id="tax-percentage">0%</span>)</span><span id="tax-amount" class="font-medium text-red-600">+ Rp 0</span></div>
                                    <div class="border-t border-slate-200 my-1"></div>
                                    <div class="flex justify-between items-center text-lg font-bold text-slate-800"><span>Total</span><span id="total-amount" class="text-teal-600">Rp 0</span></div>
                                </div>
                            </div>
                        </div>
                        <button id="pay-btn" class="w-full mt-4 bg-teal-500 text-white py-3 rounded-lg font-bold text-lg hover:bg-teal-600 transition-transform transform hover:scale-105 shadow-lg disabled:bg-slate-400 disabled:cursor-not-allowed disabled:scale-100">
                            PROSES PEMBAYARAN
                        </button>
                    </div>
                </div>
            </div>

            <!-- Kolom Kanan: Daftar Produk -->
            <div class="lg:col-span-1 flex flex-col h-full">
                <div class="flex-shrink-0 relative mb-4">
                    <input type="text" id="search-product-input" placeholder="Cari produk..." class="w-full pl-10 pr-4 py-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 transition">
                    <i class="ri-search-line text-slate-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
                </div>
                <div class="bg-white rounded-xl shadow-md flex-1 overflow-y-auto">
                    <div id="product-list-container" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-2 xl:grid-cols-3 gap-4 p-4">
                        <!-- Daftar produk akan di-render oleh JavaScript -->
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<!-- Modal Pembayaran -->
<div id="payment-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 p-4">
    <div id="payment-modal-box" class="bg-white rounded-lg shadow-xl p-6 sm:p-8 w-full max-w-md modal-enter">
        <div class="flex justify-between items-center mb-4">
            <h3 class="text-2xl font-bold">Detail Pembayaran</h3>
            <button id="close-modal-btn" class="text-slate-500 hover:text-slate-800 text-2xl">&times;</button>
        </div>
        <div class="space-y-4">
            <div class="bg-slate-100 p-4 rounded-lg text-center">
                <p class="text-slate-500">Total Tagihan</p>
                <p id="modal-total-amount" class="text-4xl font-bold text-teal-600">Rp 0</p>
            </div>
            <div>
                <label for="amount-paid" class="block text-sm font-medium text-slate-700 mb-1">Jumlah Uang Diterima</label>
                <input type="number" id="amount-paid" placeholder="Masukkan nominal..." class="w-full text-xl p-3 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 transition">
            </div>
            <div class="bg-blue-50 p-4 rounded-lg text-center">
                <p class="text-slate-500">Kembalian</p>
                <p id="change-amount" class="text-3xl font-bold text-blue-600">Rp 0</p>
            </div>
        </div>
        <button id="confirm-payment-btn" class="w-full mt-6 bg-green-500 text-white py-3 rounded-lg font-bold text-lg hover:bg-green-600 transition disabled:bg-slate-400 disabled:cursor-not-allowed">
            Konfirmasi & Cetak Struk
        </button>
    </div>
</div>

<!-- Modal Struk/Sukses -->
<div id="success-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 p-4">
     <div id="success-modal-box" class="bg-white rounded-lg shadow-xl p-6 sm:p-8 w-full max-w-sm modal-enter text-center">
        <i class="ri-checkbox-circle-fill text-6xl text-green-500 mb-4"></i>
        <h3 class="text-2xl font-bold">Transaksi Berhasil!</h3>
        <p class="text-slate-500 mt-2 mb-6">Pembayaran telah dikonfirmasi.</p>
        <button id="new-transaction-btn" class="w-full bg-teal-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-teal-600 transition">
            Transaksi Baru
        </button>
     </div>
</div>


<!-- =================================================================
     == BAGIAN 3: JAVASCRIPT (Logika & Fungsionalitas)
     == ----------------------------------------------------------- ==
     == Bagian ini menghidupkan aplikasi. Semua logika perhitungan,
     == interaksi pengguna, dan manipulasi data ada di sini.
     ================================================================= -->
<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DATA & STATE ---
    // ====================
    const products = {
        'P001': { name: 'Kopi Susu Gula Aren', price: 18000, image: 'https://placehold.co/150x150/a3816a/FFFFFF?text=Kopi' },
        'P002': { name: 'Americano', price: 15000, image: 'https://placehold.co/150x150/4a332a/FFFFFF?text=Kopi' },
        'P003': { name: 'Croissant Cokelat', price: 22000, image: 'https://placehold.co/150x150/d4a276/FFFFFF?text=Roti' },
        'P004': { name: 'Teh Lemon Jahe', price: 16000, image: 'https://placehold.co/150x150/f0e68c/000000?text=Teh' },
        'P005': { name: 'Air Mineral', price: 5000, image: 'https://placehold.co/150x150/add8e6/FFFFFF?text=Air' },
        'P006': { name: 'Donat Gula', price: 8000, image: 'https://placehold.co/150x150/ffc0cb/000000?text=Donat' },
        'P007': { name: 'Matcha Latte', price: 25000, image: 'https://placehold.co/150x150/8fbc8f/FFFFFF?text=Matcha' },
        'P008': { name: 'Kentang Goreng', price: 15000, image: 'https://placehold.co/150x150/ffd700/000000?text=Fries' },
    };
    let cart = []; // Format: [{ id, name, price, qty }]
    let currentTotal = 0;

    
    // --- DOM SELECTORS ---
    // =====================
    const cartItemsContainer = document.getElementById('cart-items-container');
    const emptyCartMessage = document.getElementById('empty-cart-message');
    const subtotalAmountEl = document.getElementById('subtotal-amount');
    const discountPercentageEl = document.getElementById('discount-percentage');
    const discountAmountEl = document.getElementById('discount-amount');
    const taxPercentageEl = document.getElementById('tax-percentage');
    const taxAmountEl = document.getElementById('tax-amount');
    const totalAmountEl = document.getElementById('total-amount');
    const discountTypeEl = document.getElementById('discount-type');
    const taxTypeEl = document.getElementById('tax-type');
    const payBtn = document.getElementById('pay-btn');
    const productListContainer = document.getElementById('product-list-container');
    const searchProductInput = document.getElementById('search-product-input');
    const currentDateEl = document.getElementById('current-date');

    // Modal Pembayaran
    const paymentModal = document.getElementById('payment-modal');
    const paymentModalBox = document.getElementById('payment-modal-box');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const modalTotalAmountEl = document.getElementById('modal-total-amount');
    const amountPaidInput = document.getElementById('amount-paid');
    const changeAmountEl = document.getElementById('change-amount');
    const confirmPaymentBtn = document.getElementById('confirm-payment-btn');
    
    // Modal Sukses
    const successModal = document.getElementById('success-modal');
    const successModalBox = document.getElementById('success-modal-box');
    const newTransactionBtn = document.getElementById('new-transaction-btn');


    // --- UI FUNCTIONS ---
    // ==================

    const formatCurrency = (amount) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount);

    const renderProductList = (filter = '') => {
        productListContainer.innerHTML = '';
        const filteredProducts = Object.entries(products).filter(([id, product]) => 
            product.name.toLowerCase().includes(filter.toLowerCase())
        );

        if (filteredProducts.length === 0) {
            productListContainer.innerHTML = `<p class="col-span-full text-center text-slate-500">Produk tidak ditemukan.</p>`;
            return;
        }

        filteredProducts.forEach(([id, product]) => {
            const productCard = document.createElement('div');
            productCard.className = 'bg-white border border-slate-200 rounded-lg p-3 cursor-pointer hover:shadow-lg hover:border-teal-500 transition-all transform hover:-translate-y-1';
            productCard.dataset.productId = id;
            productCard.innerHTML = `
                <img src="${product.image}" alt="${product.name}" class="w-full h-24 object-cover rounded-md mb-2">
                <h4 class="font-semibold text-sm truncate">${product.name}</h4>
                <p class="text-teal-600 font-bold">${formatCurrency(product.price)}</p>
            `;
            productListContainer.appendChild(productCard);
        });
    };

    const renderCart = () => {
        cartItemsContainer.innerHTML = '';
        if (cart.length === 0) {
            cartItemsContainer.appendChild(emptyCartMessage);
            payBtn.disabled = true;
        } else {
            payBtn.disabled = false;
            cart.forEach((item, index) => {
                const subTotal = item.price * item.qty;
                const tr = document.createElement('tr');
                tr.className = 'border-b border-slate-200';
                tr.innerHTML = `
                    <td class="p-4"><p class="font-medium text-sm">${item.name}</p></td>
                    <td class="p-4 text-right text-sm">${formatCurrency(item.price)}</td>
                    <td class="p-4">
                        <div class="flex items-center justify-center">
                            <button data-action="decrease" data-index="${index}" class="w-7 h-7 rounded-full bg-slate-200 hover:bg-slate-300 font-bold text-sm">-</button>
                            <span class="mx-3 font-semibold text-sm">${item.qty}</span>
                            <button data-action="increase" data-index="${index}" class="w-7 h-7 rounded-full bg-slate-200 hover:bg-slate-300 font-bold text-sm">+</button>
                        </div>
                    </td>
                    <td class="p-4 text-right font-semibold text-sm">${formatCurrency(subTotal)}</td>
                    <td class="p-4 text-center">
                        <button data-action="remove" data-index="${index}" class="text-red-500 hover:text-red-700 text-lg"><i class="ri-delete-bin-line"></i></button>
                    </td>
                `;
                cartItemsContainer.appendChild(tr);
            });
        }
        updateTotals();
    };
    
    const toggleModal = (modal, modalBox, show) => {
        if (show) {
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalBox.classList.remove('modal-enter');
                modalBox.classList.add('modal-enter-active');
            }, 10);
        } else {
            modalBox.classList.remove('modal-enter-active');
            modalBox.classList.add('modal-leave-active');
            setTimeout(() => {
                modal.classList.add('hidden');
                modalBox.classList.remove('modal-leave-active');
                modalBox.classList.add('modal-enter'); // Reset for next open
            }, 300);
        }
    };

    // --- LOGIC FUNCTIONS ---
    // =====================

    const updateTotals = () => {
        const subtotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
        const discountPercentage = parseFloat(discountTypeEl.value);
        const discountAmount = (subtotal * discountPercentage) / 100;
        const subtotalAfterDiscount = subtotal - discountAmount;
        const taxPercentage = parseFloat(taxTypeEl.value);
        const taxAmount = (subtotalAfterDiscount * taxPercentage) / 100;
        
        currentTotal = subtotalAfterDiscount + taxAmount;

        subtotalAmountEl.textContent = formatCurrency(subtotal);
        discountPercentageEl.textContent = `${discountPercentage}%`;
        discountAmountEl.textContent = `- ${formatCurrency(discountAmount)}`;
        taxPercentageEl.textContent = `${taxPercentage}%`;
        taxAmountEl.textContent = `+ ${formatCurrency(taxAmount)}`;
        totalAmountEl.textContent = formatCurrency(currentTotal);
    };

    const addItemToCart = (productId) => {
        const product = products[productId];
        if (!product) return;

        const existingItem = cart.find(item => item.id === productId);
        if (existingItem) {
            existingItem.qty++;
        } else {
            cart.push({ id: productId, name: product.name, price: product.price, qty: 1 });
        }
        renderCart();
    };
    
    const resetTransaction = () => {
        cart = [];
        discountTypeEl.value = '0';
        taxTypeEl.value = '0';
        renderCart();
    };
    
    const updateDate = () => {
        const today = new Date();
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        currentDateEl.textContent = today.toLocaleDateString('id-ID', options);
    };


    // --- EVENT LISTENERS ---
    // =======================

    searchProductInput.addEventListener('input', (e) => renderProductList(e.target.value));
    
    productListContainer.addEventListener('click', (e) => {
        const card = e.target.closest('[data-product-id]');
        if (card) {
            addItemToCart(card.dataset.productId);
        }
    });

    cartItemsContainer.addEventListener('click', (e) => {
        const target = e.target.closest('button');
        if (!target) return;

        const action = target.dataset.action;
        const index = parseInt(target.dataset.index);

        if (action === 'increase') cart[index].qty++;
        else if (action === 'decrease') {
            cart[index].qty--;
            if (cart[index].qty === 0) cart.splice(index, 1);
        } else if (action === 'remove') cart.splice(index, 1);
        
        renderCart();
    });
    
    discountTypeEl.addEventListener('change', updateTotals);
    taxTypeEl.addEventListener('change', updateTotals);
    
    payBtn.addEventListener('click', () => {
        modalTotalAmountEl.textContent = formatCurrency(currentTotal);
        amountPaidInput.value = '';
        changeAmountEl.textContent = formatCurrency(0);
        confirmPaymentBtn.disabled = true;
        toggleModal(paymentModal, paymentModalBox, true);
        amountPaidInput.focus();
    });

    closeModalBtn.addEventListener('click', () => toggleModal(paymentModal, paymentModalBox, false));

    amountPaidInput.addEventListener('input', () => {
        const amountPaid = parseFloat(amountPaidInput.value) || 0;
        const change = amountPaid - currentTotal;
        changeAmountEl.textContent = formatCurrency(change < 0 ? 0 : change);
        confirmPaymentBtn.disabled = amountPaid < currentTotal;
    });

    confirmPaymentBtn.addEventListener('click', () => {
        toggleModal(paymentModal, paymentModalBox, false);
        setTimeout(() => {
            toggleModal(successModal, successModalBox, true);
        }, 300);
    });
    
    newTransactionBtn.addEventListener('click', () => {
        toggleModal(successModal, successModalBox, false);
        resetTransaction();
    });


    // --- INITIALIZATION ---
    // ======================
    updateDate();
    renderProductList();
    renderCart();

});
</script>
</body>
</html>

