<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Kasir Modern</title>
    <!-- Menggunakan Tailwind CSS untuk styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Menggunakan Google Fonts untuk tipografi -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Menggunakan Remix Icon untuk ikon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet"/>
</head>

<!-- =================================================================
     == BAGIAN 2: CSS (Gaya Tampilan)
     == ----------------------------------------------------------- ==
     == Bagian ini mengatur semua gaya visual aplikasi seperti warna,
     == font, dan efek custom.
     ================================================================= -->
<style>
    /* Style kustom untuk scrollbar agar lebih modern */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; }
    ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
    ::-webkit-scrollbar-thumb:hover { background: #64748b; }

    /* Menggunakan font Inter sebagai default */
    body {
        font-family: 'Inter', sans-serif;
        background-color: #f8fafc; /* Warna latar belakang lebih cerah */
    }
    .active-nav {
        background-color: #0d9488;
        color: white;
    }
    .nav-item:hover {
        background-color: #14b8a6;
        color: white;
    }
    /* Animasi untuk modal */
    .modal-enter { opacity: 0; transform: scale(0.95); }
    .modal-enter-active { opacity: 1; transform: scale(1); transition: all 300ms ease-out; }
    .modal-leave-active { opacity: 0; transform: scale(0.95); transition: all 300ms ease-in; }
</style>

<body class="antialiased text-slate-800">

<!-- =================================================================
     == BAGIAN 1: HTML (Struktur Halaman)
     == ----------------------------------------------------------- ==
     == Bagian ini berisi semua elemen yang membentuk tampilan
     == aplikasi, seperti sidebar, keranjang, daftar produk, dan modal.
     ================================================================= -->
<div class="flex flex-col lg:flex-row min-h-screen">
    <!-- Sidebar Navigasi -->
    <nav class="bg-teal-600 text-white w-full lg:w-64 flex-shrink-0">
        <div class="flex items-center justify-center p-4 lg:p-6 shadow-md">
            <i class="ri-shopping-cart-2-fill text-3xl mr-3"></i>
            <h1 class="text-xl font-bold">KasirKu V2</h1>
        </div>
        <ul class="flex flex-row lg:flex-col p-2 lg:p-4 lg:space-y-2 justify-center lg:justify-start">
            <li><a href="index.html" class="flex items-center p-3 rounded-lg nav-item active-nav"><i class="ri-money-dollar-box-line text-xl mr-3"></i><span class="hidden lg:inline">Transaksi</span></a></li>
            <li><a href="database.html" class="flex items-center p-3 rounded-lg nav-item"><i class="ri-database-2-line text-xl mr-3"></i><span class="hidden lg:inline">Database</span></a></li>
            <li><a href="shift.html" class="flex items-center p-3 rounded-lg nav-item"><i class="ri-time-line text-xl mr-3"></i><span class="hidden lg:inline">Shift</span></a></li>
            <li><a href="laporan.html" class="flex items-center p-3 rounded-lg nav-item"><i class="ri-file-chart-line text-xl mr-3"></i><span class="hidden lg:inline">Laporan</span></a></li>
            <li><a href="keuangan.html" class="flex items-center p-3 rounded-lg nav-item"><i class="ri-bank-line text-xl mr-3"></i><span class="hidden lg:inline">Keuangan</span></a></li>
            <li><a href="pengaturan.html" class="flex items-center p-3 rounded-lg nav-item"><i class="ri-settings-3-line text-xl mr-3"></i><span class="hidden lg:inline">Pengaturan</span></a></li>
        </ul>
    </nav>

    <!-- Konten Utama -->
    <main class="flex-1 p-4 lg:p-6 xl:p-8 flex flex-col lg:flex-row gap-6">
        <!-- Kolom Kiri: Keranjang dan Pembayaran -->
        <div class="w-full lg:w-3/5 flex flex-col bg-white rounded-xl shadow-md">
            <!-- Header Keranjang -->
            <div class="p-4 border-b border-slate-200">
                <div class="flex justify-between items-center">
                    <h2 class="text-xl font-bold text-slate-800">Keranjang</h2>
                    <div class="relative">
                        <input type="text" id="search-input" placeholder="Scan atau masukkan kode..." class="w-48 sm:w-64 pl-10 pr-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500 transition">
                        <i class="ri-barcode-line text-slate-400 absolute left-3 top-1/2 -translate-y-1/2"></i>
                    </div>
                </div>
            </div>

            <!-- Tabel Keranjang -->
            <div class="flex-grow overflow-auto">
                <table class="w-full text-left">
                    <thead class="bg-slate-50 sticky top-0">
                        <tr>
                            <th class="p-4 font-semibold text-slate-600 text-sm">PRODUK</th>
                            <th class="p-4 font-semibold text-slate-600 text-sm">HARGA</th>
                            <th class="p-4 font-semibold text-slate-600 text-sm text-center">QTY</th>
                            <th class="p-4 font-semibold text-slate-600 text-sm text-right">SUBTOTAL</th>
                            <th class="p-4 font-semibold text-slate-600 text-sm text-center"></th>
                        </tr>
                    </thead>
                    <tbody id="cart-items">
                        <!-- Item keranjang akan ditambahkan oleh JavaScript -->
                    </tbody>
                </table>
                <div id="empty-cart-message" class="text-center p-16 text-slate-400">
                    <i class="ri-shopping-cart-line text-5xl mb-4"></i>
                    <p class="font-medium">Keranjang masih kosong</p>
                    <p class="text-sm">Silakan tambahkan produk</p>
                </div>
            </div>

            <!-- Footer Pembayaran -->
            <div class="p-4 border-t border-slate-200 bg-slate-50 rounded-b-xl">
                <div class="flex flex-col sm:flex-row justify-between items-center gap-4">
                    <div class="text-left">
                        <p class="text-sm text-slate-600">Total Belanja</p>
                        <p id="total-price" class="text-3xl font-bold text-teal-600">Rp 0</p>
                    </div>
                    <div class="flex w-full sm:w-auto gap-2">
                        <button id="clear-cart-btn" class="w-1/2 sm:w-auto bg-red-100 text-red-600 font-semibold px-4 py-3 rounded-lg hover:bg-red-200 transition">Hapus</button>
                        <button id="pay-btn" class="w-1/2 sm:w-auto bg-teal-500 text-white font-semibold px-8 py-3 rounded-lg hover:bg-teal-600 transition shadow">Bayar</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Kolom Kanan: Daftar Produk -->
        <div class="w-full lg:w-2/5 flex flex-col bg-white rounded-xl shadow-md">
             <div class="p-4 border-b border-slate-200">
                <h2 class="text-xl font-bold text-slate-800">Daftar Produk</h2>
            </div>
            <div id="product-list" class="grid grid-cols-2 md:grid-cols-3 gap-3 p-3 overflow-auto">
                <!-- Produk akan ditambahkan oleh JavaScript -->
            </div>
        </div>
    </main>
</div>

<!-- Modal Pembayaran -->
<div id="payment-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50 p-4">
    <div id="payment-modal-box" class="bg-white rounded-lg shadow-xl w-full max-w-sm modal-enter">
        <div class="flex justify-between items-center p-4 border-b border-slate-200">
            <h3 class="text-xl font-bold">Detail Pembayaran</h3>
            <button id="close-modal-btn" class="text-slate-500 hover:text-slate-800 text-2xl">&times;</button>
        </div>
        <div class="p-6">
            <div class="mb-4">
                <label class="block text-sm text-slate-600 mb-1">Total Tagihan</label>
                <p id="modal-total-tagihan" class="text-3xl font-bold text-teal-600">Rp 0</p>
            </div>
            <div class="mb-4">
                <label for="amount-paid" class="block text-sm font-medium text-slate-700 mb-1">Jumlah Uang Dibayar</label>
                <input type="number" id="amount-paid" class="w-full p-3 border border-slate-300 rounded-lg text-lg focus:outline-none focus:ring-2 focus:ring-teal-500" placeholder="Masukkan nominal...">
            </div>
            <div class="mb-6">
                <label class="block text-sm text-slate-600 mb-1">Kembalian</label>
                <p id="change-due" class="text-2xl font-bold text-slate-800">Rp 0</p>
            </div>
            <button id="confirm-payment-btn" class="w-full bg-teal-500 text-white font-semibold py-3 rounded-lg hover:bg-teal-600 transition disabled:bg-slate-300">Konfirmasi Pembayaran</button>
        </div>
    </div>
</div>

<!-- Notifikasi Sukses -->
<div id="success-notification" class="fixed top-5 right-5 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300">
    <i class="ri-check-line mr-2"></i> Pembayaran Berhasil!
</div>


<!-- =================================================================
     == BAGIAN 3: JAVASCRIPT (Logika & Fungsionalitas)
     == ----------------------------------------------------------- ==
     == Bagian ini menghidupkan aplikasi. Semua logika perhitungan,
     == interaksi pengguna, dan manipulasi data ada di sini.
     ================================================================= -->
<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- DATA & STATE ---
    // ====================
    // Data produk (bisa diganti dengan data dari database/API)
    const products = [
        { id: 'P001', name: 'Kopi Susu Gula Aren', price: 18000, image: 'https://placehold.co/150x150/a78bfa/ffffff?text=Kopi' },
        { id: 'P002', name: 'Americano', price: 15000, image: 'https://placehold.co/150x150/f9a8d4/ffffff?text=Kopi' },
        { id: 'P003', name: 'Croissant Cokelat', price: 22000, image: 'https://placehold.co/150x150/fcd34d/ffffff?text=Roti' },
        { id: 'P004', name: 'Teh Lemon Jahe', price: 16000, image: 'https://placehold.co/150x150/86efac/ffffff?text=Teh' },
        { id: 'P005', name: 'Air Mineral', price: 5000, image: 'https://placehold.co/150x150/93c5fd/ffffff?text=Air' },
        { id: 'P006', name: 'Donat Gula', price: 8000, image: 'https://placehold.co/150x150/fdba74/ffffff?text=Donat' },
    ];
    // State aplikasi
    let cart = [];


    // --- DOM SELECTORS ---
    // =====================
    const searchInput = document.getElementById('search-input');
    const cartItemsContainer = document.getElementById('cart-items');
    const emptyCartMessage = document.getElementById('empty-cart-message');
    const totalPriceEl = document.getElementById('total-price');
    const clearCartBtn = document.getElementById('clear-cart-btn');
    const payBtn = document.getElementById('pay-btn');
    const productListContainer = document.getElementById('product-list');
    
    // Modal elements
    const paymentModal = document.getElementById('payment-modal');
    const paymentModalBox = document.getElementById('payment-modal-box');
    const closeModalBtn = document.getElementById('close-modal-btn');
    const modalTotalTagihan = document.getElementById('modal-total-tagihan');
    const amountPaidInput = document.getElementById('amount-paid');
    const changeDueEl = document.getElementById('change-due');
    const confirmPaymentBtn = document.getElementById('confirm-payment-btn');
    const successNotification = document.getElementById('success-notification');


    // --- UI FUNCTIONS ---
    // ==================
    /**
     * Format angka menjadi format mata uang Rupiah.
     * @param {number} amount - Angka yang akan diformat.
     * @returns {string} String dalam format mata uang.
     */
    const formatCurrency = (amount) => new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount);

    /**
     * Merender semua item di dalam state `cart` ke dalam tabel.
     */
    const renderCart = () => {
        cartItemsContainer.innerHTML = ''; // Kosongkan tabel sebelum render ulang

        if (cart.length === 0) {
            emptyCartMessage.style.display = 'block';
        } else {
            emptyCartMessage.style.display = 'none';
            cart.forEach(item => {
                const tr = document.createElement('tr');
                tr.className = 'border-b border-slate-200';
                tr.innerHTML = `
                    <td class="p-4">
                        <p class="font-medium">${item.name}</p>
                        <p class="text-sm text-slate-500">Kode: ${item.id}</p>
                    </td>
                    <td class="p-4 text-sm">${formatCurrency(item.price)}</td>
                    <td class="p-4 text-center">
                        <div class="flex items-center justify-center">
                            <button data-id="${item.id}" class="decrease-qty bg-slate-200 w-6 h-6 rounded-full font-bold">-</button>
                            <span class="mx-3 font-medium">${item.quantity}</span>
                            <button data-id="${item.id}" class="increase-qty bg-slate-200 w-6 h-6 rounded-full font-bold">+</button>
                        </div>
                    </td>
                    <td class="p-4 text-right font-semibold">${formatCurrency(item.price * item.quantity)}</td>
                    <td class="p-4 text-center">
                        <button data-id="${item.id}" class="remove-item text-red-500 hover:text-red-700 text-lg"><i class="ri-delete-bin-line"></i></button>
                    </td>
                `;
                cartItemsContainer.appendChild(tr);
            });
        }
        updateTotal();
    };
    
    /**
     * Merender daftar produk ke dalam kolom kanan.
     */
    const renderProducts = () => {
        productListContainer.innerHTML = '';
        products.forEach(product => {
            const productCard = document.createElement('div');
            productCard.className = 'product-card border rounded-lg p-3 flex flex-col items-center cursor-pointer hover:shadow-md hover:border-teal-500 transition';
            productCard.dataset.id = product.id;
            productCard.innerHTML = `
                <img src="${product.image}" alt="${product.name}" class="w-24 h-24 object-cover rounded-md mb-2">
                <p class="font-semibold text-sm text-center">${product.name}</p>
                <p class="text-xs text-slate-500">${formatCurrency(product.price)}</p>
            `;
            productListContainer.appendChild(productCard);
        });
    };

    /**
     * Membuka atau menutup modal pembayaran.
     * @param {boolean} show - True untuk membuka, false untuk menutup.
     */
    const toggleModal = (show) => {
        if (show) {
            const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
            modalTotalTagihan.textContent = formatCurrency(total);
            amountPaidInput.value = '';
            changeDueEl.textContent = 'Rp 0';
            confirmPaymentBtn.disabled = true;
            paymentModal.classList.remove('hidden');
            setTimeout(() => paymentModalBox.classList.add('modal-enter-active'), 10);
        } else {
            paymentModalBox.classList.remove('modal-enter-active');
            paymentModalBox.classList.add('modal-leave-active');
            setTimeout(() => {
                paymentModal.classList.add('hidden');
                paymentModalBox.classList.remove('modal-leave-active');
            }, 300);
        }
    };

    /**
     * Menampilkan notifikasi sukses.
     */
    const showSuccessNotification = () => {
        successNotification.classList.remove('translate-x-full');
        setTimeout(() => {
            successNotification.classList.add('translate-x-full');
        }, 3000); // Notifikasi hilang setelah 3 detik
    };


    // --- LOGIC FUNCTIONS ---
    // =====================
    /**
     * Menambahkan produk ke keranjang atau menambah jumlah jika sudah ada.
     * @param {string} productId - ID produk yang akan ditambahkan.
     */
    const addItemToCart = (productId) => {
        const product = products.find(p => p.id === productId);
        if (!product) return; // Produk tidak ditemukan

        const cartItem = cart.find(item => item.id === productId);

        if (cartItem) {
            cartItem.quantity++;
        } else {
            cart.push({ ...product, quantity: 1 });
        }
        renderCart();
    };

    /**
     * Mengubah jumlah (quantity) item di keranjang.
     * @param {string} productId - ID produk.
     * @param {'increase' | 'decrease'} action - Aksi yang dilakukan.
     */
    const updateQuantity = (productId, action) => {
        const cartItem = cart.find(item => item.id === productId);
        if (!cartItem) return;

        if (action === 'increase') {
            cartItem.quantity++;
        } else if (action === 'decrease') {
            cartItem.quantity--;
            if (cartItem.quantity === 0) {
                // Hapus item jika quantity menjadi 0
                cart = cart.filter(item => item.id !== productId);
            }
        }
        renderCart();
    };

    /**
     * Menghapus item dari keranjang.
     * @param {string} productId - ID produk.
     */
    const removeItemFromCart = (productId) => {
        cart = cart.filter(item => item.id !== productId);
        renderCart();
    };

    /**
     * Mengupdate total harga di footer pembayaran.
     */
    const updateTotal = () => {
        const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
        totalPriceEl.textContent = formatCurrency(total);
        // Disable tombol bayar jika keranjang kosong
        payBtn.disabled = cart.length === 0;
    };
    
    /**
     * Menghitung kembalian di modal pembayaran.
     */
    const calculateChange = () => {
        const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
        const amountPaid = parseFloat(amountPaidInput.value) || 0;
        const change = amountPaid - total;

        if (change >= 0) {
            changeDueEl.textContent = formatCurrency(change);
            confirmPaymentBtn.disabled = false;
        } else {
            changeDueEl.textContent = 'Rp 0';
            confirmPaymentBtn.disabled = true;
        }
    };


    // --- EVENT LISTENERS ---
    // =======================
    // Menambahkan item via input kode
    searchInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            const productId = e.target.value.toUpperCase();
            addItemToCart(productId);
            e.target.value = '';
        }
    });

    // Event listener untuk tombol di dalam tabel keranjang (delegation)
    cartItemsContainer.addEventListener('click', (e) => {
        const target = e.target;
        const productId = target.closest('button')?.dataset.id;
        
        if (!productId) return;

        if (target.closest('.increase-qty')) {
            updateQuantity(productId, 'increase');
        } else if (target.closest('.decrease-qty')) {
            updateQuantity(productId, 'decrease');
        } else if (target.closest('.remove-item')) {
            removeItemFromCart(productId);
        }
    });

    // Event listener untuk daftar produk (delegation)
    productListContainer.addEventListener('click', (e) => {
        const productCard = e.target.closest('.product-card');
        if (productCard) {
            addItemToCart(productCard.dataset.id);
        }
    });

    // Tombol Hapus Keranjang
    clearCartBtn.addEventListener('click', () => {
        if (confirm('Apakah Anda yakin ingin mengosongkan keranjang?')) {
            cart = [];
            renderCart();
        }
    });

    // Tombol Bayar
    payBtn.addEventListener('click', () => {
        if (cart.length > 0) {
            toggleModal(true);
        }
    });

    // Tombol tutup modal
    closeModalBtn.addEventListener('click', () => toggleModal(false));

    // Input uang dibayar
    amountPaidInput.addEventListener('input', calculateChange);

    // Tombol Konfirmasi Pembayaran
    confirmPaymentBtn.addEventListener('click', () => {
        // Logika setelah pembayaran berhasil
        showSuccessNotification();
        cart = [];
        renderCart();
        toggleModal(false);
    });

    // --- INITIALIZATION ---
    // ======================
    renderProducts();
    renderCart(); // Render keranjang saat pertama kali load
});
</script>
</body>
</html>
